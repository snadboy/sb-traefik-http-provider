# Logrotate configuration for Traefik HTTP Provider
# Place this file in /etc/logrotate.d/traefik-provider or run with logrotate manually

# General configuration for all log files except specific ones below
/var/log/traefik-provider/*.log {
    # Rotate logs daily
    daily

    # Keep 14 days worth of logs
    rotate 14

    # Compress rotated logs
    compress
    delaycompress

    # Don't rotate empty logs
    notifempty

    # Create new log files with specific permissions
    create 0644 root root

    # Use date as extension for rotated files
    dateext
    dateformat -%Y%m%d

    # Maximum size before rotation (even if not daily yet)
    maxsize 100M

    # Continue writing to the same file after rotation
    copytruncate

    # Don't fail if log files don't exist yet
    missingok

    # Shared scripts for all log files
    sharedscripts

    # Run post-rotation script
    postrotate
        # Send SIGUSR1 to the application to reopen log files if needed
        # Or restart the logging system
        if [ -f /var/run/traefik-provider.pid ]; then
            kill -USR1 $(cat /var/run/traefik-provider.pid) 2>/dev/null || true
        fi

        # Optional: Send notification or metrics
        # echo "Logs rotated at $(date)" >> /var/log/traefik-provider/rotation.log
    endscript
}